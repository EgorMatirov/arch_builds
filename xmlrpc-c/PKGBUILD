# Maintainer: Filippov Aleksey <sarum9in@gmail.com>
pkgname=xmlrpc-c-svn
pkgver=2312
pkgrel=1
pkgdesc="This library provides a modular implementation of XML-RPC for C and C++"
arch=('i686' 'x86_64')
url="http://xmlrpc-c.sourceforge.net/"
license=('custom:xmlrpc-c')
groups=()
depends=('curl' 'libxml2' 'gcc-libs' 'zlib')
makedepends=('libtool' 'subversion')
provides=('xmlrpc-c')
conflicts=('xmlrpc-c')
replaces=('xmlrpc-c')
backup=()
options=('!makeflags' '!libtool')
install=
source=()
noextract=()
md5sums=()

_svntrunk=http://xmlrpc-c.svn.sourceforge.net/svnroot/xmlrpc-c/advanced
_svnmod=xmlrpc-c

build() {
  cd "$srcdir"

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_svnmod-build"
  cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
  cd "$srcdir/$_svnmod-build"

  #./autogen.sh
  #patch -Np0 -i "${srcdir}/callInfo.patch"
  ./configure \
        --prefix=/usr \
        --disable-wininet-client \
        --enable-curl-client \
        --disable-libwww-client \
        --enable-tools \
        --enable-abyss-server \
        --enable-cgi-server \
        --enable-cplusplus \
        --enable-abyss-threads \
        --enable-libxml2-backend
  make CFLAGS_PERSONAL="${CFLAGS}" || return 1
}

package() {
  cd "$srcdir/$_svnmod-build"
  make DESTDIR="$pkgdir/" install
  cp "$srcdir/$_svnmod-build/include/xmlrpc-c/"* "$pkgdir/usr/include/xmlrpc-c/"
  mkdir -p "$pkgdir/usr/share"
  #mv "$pkgdir/man" "$pkgdir/usr/share/man"
}
